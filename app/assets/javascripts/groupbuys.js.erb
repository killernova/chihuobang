//= require foundation-datetimepicker

//= require ckeditor/init


$(document).ready(function(){
  $('.new-groupbuy').find('input').each(function(){
    if(($(this).val()=='0' || $(this).val()=='0.0') && location.pathname.split('/')[2] == 'new'){
      $(this).val('');
    }
  });
});

$('.new_participant').on('change', '.goods-weight', function(){
  var that = $(this);
  var nums = that.val();
  if(nums == '' || nums == undefined || isNaN(nums) == true || parseInt(nums) < 1) {
    $(this).val('');
    alert("只能输入正整数");
    return;
  }
});

//倒计时

$('.groupbuy-list').each(function(){
  var endTime = $(this).data('endtime');
  var day = $(this).data('day');
  var that = $(this);
  window.setInterval(function(){
    var EndTime= endTime;
    var NowTime = new Date();
    var t =EndTime * 1000 - NowTime.getTime();
    if(t < 0) {
      //console.log(t);
      var over = $('.groupbuys-index-list').data('over');
      $(that).find('.countdown').text(over);
      return;
    }

    var d=Math.floor(t/1000/60/60/24);
    var h=Math.floor(t/1000/60/60%24);
    var m=Math.floor(t/1000/60%60);
    var s=Math.floor(t/1000%60);

    that.find('.countdown-day').text(d + day);
    that.find('.countdown-hour').text(h + ':');
    that.find('.countdown-minute').text(m + ':');
    that.find('.countdown-second').text(s);
  }, 1000)

  
  
  //setInterval(getRTime,1000);
});

//--------时间选择插件----------//
var nowTemp = new Date();
var now = new Date(nowTemp.getFullYear(), nowTemp.getMonth(), nowTemp.getDate(), 0, 0, 0, 0);
var checkin = $('#dpd1').fdatetimepicker({
  onRender: function (date) {
    return date.valueOf() < now.valueOf() ? 'disabled' : '';
  }
}).on('changeDate', function (ev) {
  if (ev.date.valueOf() > checkout.date.valueOf()) {
    var newDate = new Date(ev.date)
    newDate.setDate(newDate.getDate() + 1);
    checkout.update(newDate);
  }
  checkin.hide();
  $('#dpd2')[0].focus();
}).data('datepicker');
var checkout = $('#dpd2').fdatetimepicker({
  onRender: function (date) {
    return date.valueOf() <= checkin.date.valueOf() ? 'disabled' : '';
  }
}).on('changeDate', function (ev) {
  checkout.hide();
}).data('datepicker');
