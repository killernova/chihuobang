//= require foundation-datetimepicker
//= require 'china_city/jquery.china_city'
//= require ckeditor/init
//= require photos

	// implementation of disabled form fields
	// $('.datetimepicker').fdatetimepicker({
 //    language: 'zh'
 //  });

	$(document).ready(function(){
  $('.new-event').find('input').each(function(){
  	if(($(this).val()=='0' || $(this).val()=='0.0') && location.pathname.split('/')[2] == 'new'){
  		$(this).val('');
  	}
  });
});

	var nowTemp = new Date();
	var now = new Date(nowTemp.getFullYear(), nowTemp.getMonth(), nowTemp.getDate(), 0, 0, 0, 0);
	var checkin = $('#dpd1').fdatetimepicker({
		onRender: function (date) {
			return date.valueOf() < now.valueOf() ? 'disabled' : '';
		}
	}).on('changeDate', function (ev) {
		if (ev.date.valueOf() > checkout.date.valueOf()) {
			var newDate = new Date(ev.date)
			newDate.setDate(newDate.getDate() + 1);
			checkout.update(newDate);
		}
		checkin.hide();
		$('#dpd2')[0].focus();
	}).data('datepicker');
	var checkout = $('#dpd2').fdatetimepicker({
		onRender: function (date) {
			return date.valueOf() <= checkin.date.valueOf() ? 'disabled' : '';
		}
	}).on('changeDate', function (ev) {
		checkout.hide();
	}).data('datepicker');

	//--------调用微信支付---------
	$('.wc-pay').on("click", function(){
		$('form .pay-form').submit();
	})

	//倒计时

$('.event-list').each(function(){
  var endTime = $(this).data('endtime');
  var day = $(this).data('day');
  var that = $(this);
  window.setInterval(function(){
    var EndTime= endTime;
    var NowTime = new Date();
    var t =EndTime * 1000 - NowTime.getTime();
    if(t < 0) {
      //console.log(t);
      var over = $('.events-index-list').data('over');
      that.find('.countdown').text(over);
      return;
    }

    var d=Math.floor(t/1000/60/60/24);
    var h=Math.floor(t/1000/60/60%24);
    var m=Math.floor(t/1000/60%60);
    var s=Math.floor(t/1000%60);

    that.find('.countdown-day').text(d + day);
    that.find('.countdown-hour').text(h + ':');
    that.find('.countdown-minute').text(m + ':');
    that.find('.countdown-second').text(s);
  }, 1000)

  
  
  //setInterval(getRTime,1000);




});

//------------是否显示活动价格-----------------//
$('.free-event').on('click', function(){
  $('.event-price').toggle();
});

//--------------编辑图片---------------------//

$('.dz-image .trash').on('click', function(){
  var ids = [];
  var deleteIds = $('.delete-ids').val() + ',' + $(this).parent().attr('id');
  $('.delete-ids').val(deleteIds);

  var that = $(this);
  $(this).parent().remove();
  if($('.dz-image').length > 0) {
    $('.dz-image').each(function(){
      ids.push($(this).attr('id'));
    });
  }
  $('.pic-ids').val(ids.join(','));
});

//----------活动报名成功后不显示详情------------//

$(document).ready(function(){
  $('.groupbuy-detail').hide();
})

//-----------活动报名人数大于0----------------//
$(document).ready(function(){
  $('.event-participant-number').on('change', function(){
    var num = $(this).val();
    if(isNaN(num) || num < 1 || num % 1 != 0) {
      alert('请输入大于0的正整数');
      $(this).val('');
    }
  })
})
