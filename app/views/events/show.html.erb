
<% provide :title, t(:event_detail) %>

<div class="row">
  <div class="large-2 columns">
    <%= image_tag @event.pic_url, class: 'profile-image round' if @event %>
  </div>
  <div class="large-10 columns">
    <h2><%= @event.title %></h2>
  </div>
</div>
<div class="row">
  <div class="small-12 columns">
    <%= event_info(@event) %><br>
  </div>
</div>
<div class="row">
  <div class="small-12 columns">
    <table style="width:100%">
      <tr>
        <th><%=t(:event)%> No.</th>
        <td>#<%= @event.id.to_s.rjust(10,'0') %></td>
      </tr>
      <tr>
        <th><%=t(:start_time)%></th>
        <td><%= @event.start_time.strftime("%Y-%m-%d %H:%M") %></td>
      </tr>
      <tr>
        <th><%=t(:end_time)%></th>
        <td><%=@event.end_time.strftime("%Y-%m-%d %H:%M")%></td>
      </tr>
      <tr>
        <th><%=t(:address)%></th>
        <td><%=@event.address%></td>
      </tr>
      <tr>
        <th><%=t(:limited_people)%></th>
        <td><%=@event.limited_people%></td>
      </tr>
      <tr>
        <th><%=t(:participants)%></th>
        <td><%=@participants.count%></td>
      </tr>
      <tr>
        <th><%=t(:price)%></th>
        <td>￥<%=@event.price%></td>
      </tr>
      <tr>
        <td colspan='2'><%= @event.body.html_safe  %></td>
      </tr>
    </table>
  </div>
</div>
<% if current_user == @event.user %>
<div class="row">
  <div class="small-12 columns">
    <%= link_to '<i class="fa fa-pencil"></i>'.html_safe + ' ' + t(:edit), edit_event_path(@event), class:"tiny button radius" %>
    <%= link_to '<i class="fa fa-times"></i>'.html_safe + ' ' + t(:delete), @event, method: :delete,
    class:"tiny button alert radius",
      data: {confirm: '?'} %>
    </div>
  </div>
  <% end %>
  <div class="row">
    <div class="small-12 columns">
      <ul class="tabs" data-tab role="tablist">
        <li class="tab-title active">
          <a href="#participants"><i class="fa fa-user-plus"></i><%=t(:goings)%> (<%=@event.participants_count%>)</a>
        </li>
        <li class="tab-title">
          <a href="#comments"><i class="fa fa-comments"></i><%=t(:comments)%> (<%=@event.comments_count%>)</a>
        </li>
      </ul>
      <div class="tabs-content panel">
        <div class="content active" id="participants">
          <%=render 'participants/form' ,:locals=>{@parent=>@parent,@participant=>@participant} if current_user%>
          <%= render @participants %>
        </div>
        <div class="content" id="comments">
          <%=render 'comments/form' ,:locals=>{@parent=>@parent,@comment=>@comment} if current_user%>
          <div class="comments-list">
            <%= render @comments %>
          </div>
          <a style="width:100%" href="#" class="more-comments tiny expanded button" data-parent="<%= params[:controller].gsub(/\w$/, '') %>" data-count="<%= @comments.count %>" data-id="<%= @event.id %>" data-url="/<%= params[:controller] %>/more_comments"><%= t(:more) %></a>
        </div>
      </div>
    </div>
  </div>
  <div id="container"></div>

  <style type="text/css">
    html{height:100%}
    body{height:100%;margin:0px;padding:0px}
    #container{height: 60%;width:80%;margin-left:10%;}
  </style>


  <script type="text/javascript">
  //百度地图API功能

  var map = new BMap.Map("container");
  var x = "<%= @event.x_coordinate %>";          // 创建地图实例
  var y = "<%= @event.y_coordinate %>";          // 创建地图实例
  if(x && y) {          
    var point = new BMap.Point(x, y);
    map.centerAndZoom(point, 15);
  }
  else {  // 创建点坐标
    map.centerAndZoom('上海市');
  }
</script>


